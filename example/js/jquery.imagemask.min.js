(function(e,t,n){function o(t,n){this.element=t;this.options=e.extend({},s,n);this._defaults=s;this._name=r;this.init()}var r="imageMask",i=t.document,s={propertyName:"value"};o.prototype.init=function(){e(this.element).each(function(t,n){e(n).attr("data-mask-src",e(n).attr("src"));if(c().canvas){var r=new Image,i=new Image;u(n,r,i)}else{var s=e(this).attr("data-mask-fallback");typeof s!="undefined"&&s!==!1&&e(n).attr("src",e(n).attr("data-mask-fallback"))}})};e.fn[r]=function(t){return this.each(function(){e.data(this,"plugin_"+r)||e.data(this,"plugin_"+r,new o(this,t))})};var u=function(t,n,r){e(n).load(function(){a(t,n,r)}).error(function(){}).attr("src",e(t).attr("src"));e(t).attr("src","")},a=function(t,n,r){e(r).load(function(){f(t,n,r)}).error(function(){}).attr("src",e(t).attr("data-mask"))},f=function(e,t,n){l(e,t,n)},l=function(t,n,r){var s=n.width,o=n.height,u=i.createElement("canvas");u.width=s;u.height=o;var a=u.getContext("2d"),f=i.createElement("canvas");f.width=s;f.height=o;var l=f.getContext("2d");l.drawImage(r,0,0);var c=l.getImageData(0,0,s,o),h=c.data,p=i.createElement("canvas");p.width=s;p.height=o;var d=p.getContext("2d");d.drawImage(n,0,0);var v=d.getImageData(0,0,s,o),m=v.data;for(var g=0,y=m.length;g<y;g+=4)m[g+3]=(h[g]+h[g+1]+h[g+2])/3;a.putImageData(v,0,0);var b=u.toDataURL();e(t).attr("src",b);u=null;f=null;p=null;n=null;r=null},c=function(){function e(e){return e in i.documentElement.style}function n(){var e=i.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")}function r(){return{ff:e("MozBoxSizing"),ie:e("msTransform"),ie6:!t.XMLHttpRequest,ie7:i.all&&t.XMLHttpRequest&&!XDomainRequest&&!t.opera,ie8:i.documentMode==8,opera:!!t.opera&&!!t.opera.version,safari:Object.prototype.toString.call(t.HTMLElement).indexOf("Constructor")>0,chrome:!(Object.prototype.toString.call(t.HTMLElement).indexOf("Constructor")>0)&&e("WebkitTransform"),webkit:e("WebkitTransform"),canvas:n()}}return r()}})(jQuery,window);